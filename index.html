<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ¢ãƒã‚¤ãƒ«å®Œå…¨å¯¾å¿œç‰ˆ - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç¿»è¨³ã‚¢ãƒ—ãƒª</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        .recording-pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .mobile-button {
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        .info-card {
            backdrop-filter: blur(10px);
            background-color: rgba(255, 255, 255, 0.9);
        }
        .translation-history {
            max-height: 300px;
            overflow-y: auto;
        }
        .speech-unavailable {
            background: linear-gradient(45deg, #fef3c7, #fbbf24);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-100 min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-6xl">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="text-center mb-6">
            <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">
                <i class="fas fa-language text-blue-500"></i>
                ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ ç¿»è¨³ã‚¢ãƒ—ãƒª
            </h1>
            <p class="text-gray-600 text-sm md:text-base">éŸ³å£°èªè­˜ãƒ»ç¿»è¨³ãƒ»é–¢é€£æƒ…å ±ã‚’ä¸€ã¤ã®ã‚¢ãƒ—ãƒªã§</p>
        </div>

        <!-- ãƒ–ãƒ©ã‚¦ã‚¶å¯¾å¿œçŠ¶æ³è¡¨ç¤º -->
        <div id="browserSupport" class="mb-4 p-3 rounded-lg text-sm text-center hidden">
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³æ“ä½œãƒ‘ãƒãƒ« -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6">
            <!-- éŸ³å£°èªè­˜ãƒ‘ãƒãƒ« -->
            <div class="bg-white rounded-lg shadow-lg p-4">
                <h3 class="text-lg font-semibold mb-3 text-center">
                    <i class="fas fa-microphone text-red-500"></i>
                    éŸ³å£°èªè­˜
                </h3>
                
                <!-- éŸ³å£°èªè­˜ãƒœã‚¿ãƒ³ -->
                <div class="text-center mb-4">
                    <button id="toggleRecording" class="mobile-button bg-red-500 hover:bg-red-600 text-white rounded-full p-4 md:p-6 text-xl md:text-2xl transition-all duration-300 shadow-lg">
                        <i id="micIcon" class="fas fa-microphone"></i>
                    </button>
                    <div id="recordingStatus" class="mt-2 text-sm font-medium text-gray-600">
                        éŸ³å£°èªè­˜åœæ­¢ä¸­
                    </div>
                </div>

                <!-- æ‰‹å‹•å…¥åŠ›ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰ -->
                <div class="border-t pt-3">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        æ‰‹å‹•å…¥åŠ›ï¼ˆéŸ³å£°èªè­˜ã®ä»£æ›¿ï¼‰
                    </label>
                    <textarea id="manualInput" 
                              placeholder="ç¿»è¨³ã—ãŸã„ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..." 
                              class="w-full p-3 border border-gray-300 rounded-lg resize-none text-sm"
                              rows="3"></textarea>
                    <button id="translateManual" class="mobile-button w-full mt-2 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg text-sm font-medium">
                        <i class="fas fa-language mr-1"></i>
                        æ‰‹å‹•ç¿»è¨³
                    </button>
                </div>

                <!-- èªè­˜ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆ -->
                <div class="border-t pt-3 mt-3">
                    <label class="block text-sm font-medium text-gray-700 mb-2">èªè­˜çµæœ</label>
                    <div id="recognizedText" class="bg-gray-50 p-3 rounded-lg min-h-16 text-sm">
                        éŸ³å£°èªè­˜çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™
                    </div>
                </div>
            </div>

            <!-- ç¿»è¨³çµæœãƒ‘ãƒãƒ« -->
            <div class="bg-white rounded-lg shadow-lg p-4">
                <h3 class="text-lg font-semibold mb-3 text-center">
                    <i class="fas fa-exchange-alt text-green-500"></i>
                    ç¿»è¨³çµæœ
                </h3>
                
                <!-- è¨€èªæ–¹å‘è¡¨ç¤º -->
                <div class="text-center mb-3">
                    <span id="languageDirection" class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">
                        æ—¥æœ¬èª â‡„ è‹±èª
                    </span>
                </div>

                <!-- ç¾åœ¨ã®ç¿»è¨³ -->
                <div class="bg-green-50 p-4 rounded-lg mb-4 min-h-24">
                    <div id="currentTranslation" class="text-gray-600 text-center">
                        ç¿»è¨³çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™
                    </div>
                </div>

                <!-- ç¿»è¨³å±¥æ­´ -->
                <div class="border-t pt-3">
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-sm font-medium text-gray-700">ç¿»è¨³å±¥æ­´</label>
                        <button id="clearHistory" class="text-xs text-red-500 hover:text-red-700 mobile-button">
                            <i class="fas fa-trash mr-1"></i>ã‚¯ãƒªã‚¢
                        </button>
                    </div>
                    <div id="translationHistory" class="translation-history bg-gray-50 p-3 rounded-lg">
                        <p class="text-gray-500 text-sm text-center">ç¿»è¨³å±¥æ­´ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>
                    </div>
                </div>
            </div>

            <!-- é–¢é€£æƒ…å ±ãƒ‘ãƒãƒ« -->
            <div class="bg-white rounded-lg shadow-lg p-4">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="text-lg font-semibold">
                        <i class="fas fa-info-circle text-purple-500"></i>
                        é–¢é€£æƒ…å ±
                    </h3>
                    <button id="refreshInfo" class="mobile-button text-sm text-blue-500 hover:text-blue-700">
                        <i class="fas fa-sync-alt mr-1"></i>æ›´æ–°
                    </button>
                </div>

                <!-- ã‚¿ã‚¤ãƒãƒ¼è¡¨ç¤º -->
                <div class="text-center mb-3">
                    <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm">
                        æ¬¡ã®æ›´æ–°ã¾ã§: <span id="infoTimer">30</span>ç§’
                    </span>
                </div>

                <!-- æƒ…å ±è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
                <div id="relatedInfo" class="info-card p-4 rounded-lg min-h-48 text-sm">
                    <div class="text-center text-gray-500">
                        <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                        <p>é–¢é€£æƒ…å ±ã‚’å–å¾—ä¸­...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- çµ±è¨ˆæƒ…å ± -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            <div class="bg-white rounded-lg shadow p-4 text-center">
                <div class="text-2xl font-bold text-blue-500" id="translationCount">0</div>
                <div class="text-sm text-gray-600">ç¿»è¨³å›æ•°</div>
            </div>
            <div class="bg-white rounded-lg shadow p-4 text-center">
                <div class="text-2xl font-bold text-green-500" id="sessionTime">0:00</div>
                <div class="text-sm text-gray-600">ã‚»ãƒƒã‚·ãƒ§ãƒ³æ™‚é–“</div>
            </div>
            <div class="bg-white rounded-lg shadow p-4 text-center">
                <div class="text-2xl font-bold text-purple-500" id="infoCount">0</div>
                <div class="text-sm text-gray-600">æƒ…å ±è¡¨ç¤ºå›æ•°</div>
            </div>
            <div class="bg-white rounded-lg shadow p-4 text-center">
                <div class="text-2xl font-bold text-orange-500" id="currentLang">---</div>
                <div class="text-sm text-gray-600">æ¤œå‡ºè¨€èª</div>
            </div>
        </div>

        <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
        <div class="text-center text-sm text-gray-500">
            <p>
                <i class="fas fa-mobile-alt mr-1"></i>
                ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ–ç‰ˆ | 
                <i class="fas fa-shield-alt mr-1"></i>
                ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·
            </p>
        </div>
    </div>

    <script>
        class MobileTranslationApp {
            constructor() {
                this.recognition = null;
                this.isRecording = false;
                this.translationCount = 0;
                this.infoCount = 0;
                this.sessionStartTime = Date.now();
                this.infoTimer = 30;
                this.infoTimerInterval = null;
                this.currentLanguage = 'unknown';
                this.translationHistory = [];
                
                this.initializeApp();
                this.setupEventListeners();
                this.startInfoTimer();
                this.updateSessionTime();
                this.checkBrowserSupport();
                this.loadInitialInfo();
            }

            checkBrowserSupport() {
                const supportDiv = document.getElementById('browserSupport');
                const isHTTPS = location.protocol === 'https:' || location.hostname === 'localhost';
                const hasSpeechRecognition = 'webkitSpeechRecognition' in window || 'SpeechRecognition' in window;
                
                let message = '';
                let className = '';
                
                if (!isHTTPS) {
                    message = 'âš ï¸ HTTPSæ¥ç¶šãŒå¿…è¦ã§ã™ã€‚éŸ³å£°èªè­˜ã«ã¯æ‰‹å‹•å…¥åŠ›ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚';
                    className = 'speech-unavailable';
                } else if (!hasSpeechRecognition) {
                    message = 'âš ï¸ ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°èªè­˜ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚æ‰‹å‹•å…¥åŠ›ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚';
                    className = 'speech-unavailable';
                } else {
                    message = 'âœ… éŸ³å£°èªè­˜ã¨ã™ã¹ã¦ã®æ©Ÿèƒ½ãŒåˆ©ç”¨å¯èƒ½ã§ã™ã€‚';
                    className = 'bg-green-100 text-green-800';
                }
                
                supportDiv.textContent = message;
                supportDiv.className = `mb-4 p-3 rounded-lg text-sm text-center ${className}`;
                supportDiv.classList.remove('hidden');
            }

            initializeApp() {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.recognition = new SpeechRecognition();
                    
                    this.recognition.continuous = true;
                    this.recognition.interimResults = true;
                    this.recognition.lang = 'ja-JP';
                    
                    this.recognition.onstart = () => {
                        this.isRecording = true;
                        this.updateRecordingStatus();
                    };
                    
                    this.recognition.onresult = (event) => {
                        let finalTranscript = '';
                        let interimTranscript = '';
                        
                        for (let i = event.resultIndex; i < event.results.length; i++) {
                            const transcript = event.results[i][0].transcript;
                            if (event.results[i].isFinal) {
                                finalTranscript += transcript;
                            } else {
                                interimTranscript += transcript;
                            }
                        }
                        
                        const recognizedText = document.getElementById('recognizedText');
                        recognizedText.innerHTML = finalTranscript + '<span style="color: #888;">' + interimTranscript + '</span>';
                        
                        if (finalTranscript) {
                            this.translateText(finalTranscript);
                        }
                    };
                    
                    this.recognition.onerror = (event) => {
                        console.error('éŸ³å£°èªè­˜ã‚¨ãƒ©ãƒ¼:', event.error);
                        this.isRecording = false;
                        this.updateRecordingStatus();
                        
                        let errorMessage = 'éŸ³å£°èªè­˜ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚';
                        switch(event.error) {
                            case 'not-allowed':
                                errorMessage = 'ãƒã‚¤ã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';
                                break;
                            case 'no-speech':
                                errorMessage = 'éŸ³å£°ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚';
                                break;
                            case 'audio-capture':
                                errorMessage = 'ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚­ãƒ£ãƒ—ãƒãƒ£ã‚¨ãƒ©ãƒ¼ã€‚ãƒã‚¤ã‚¯ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';
                                break;
                            case 'network':
                                errorMessage = 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚';
                                break;
                        }
                        
                        document.getElementById('recognizedText').innerHTML = 
                            `<span style="color: #ef4444;">${errorMessage}<br>æ‰‹å‹•å…¥åŠ›ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚</span>`;
                    };
                    
                    this.recognition.onend = () => {
                        this.isRecording = false;
                        this.updateRecordingStatus();
                    };
                }
            }

            setupEventListeners() {
                // éŸ³å£°èªè­˜ãƒˆã‚°ãƒ«
                document.getElementById('toggleRecording').addEventListener('click', () => {
                    this.toggleRecording();
                });
                
                // æ‰‹å‹•ç¿»è¨³
                document.getElementById('translateManual').addEventListener('click', () => {
                    const text = document.getElementById('manualInput').value.trim();
                    if (text) {
                        document.getElementById('recognizedText').textContent = text;
                        this.translateText(text);
                        document.getElementById('manualInput').value = '';
                    }
                });
                
                // å±¥æ­´ã‚¯ãƒªã‚¢
                document.getElementById('clearHistory').addEventListener('click', () => {
                    this.clearTranslationHistory();
                });
                
                // æƒ…å ±æ›´æ–°
                document.getElementById('refreshInfo').addEventListener('click', () => {
                    this.loadRelatedInfo();
                });
                
                // Enterã‚­ãƒ¼ã§æ‰‹å‹•ç¿»è¨³
                document.getElementById('manualInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        document.getElementById('translateManual').click();
                    }
                });
            }

            toggleRecording() {
                if (!this.recognition) {
                    alert('ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°èªè­˜ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚æ‰‹å‹•å…¥åŠ›ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚');
                    return;
                }
                
                if (this.isRecording) {
                    this.recognition.stop();
                } else {
                    try {
                        this.recognition.start();
                    } catch (error) {
                        console.error('éŸ³å£°èªè­˜é–‹å§‹ã‚¨ãƒ©ãƒ¼:', error);
                        alert('éŸ³å£°èªè­˜ã‚’é–‹å§‹ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚æ‰‹å‹•å…¥åŠ›ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚');
                    }
                }
            }

            updateRecordingStatus() {
                const button = document.getElementById('toggleRecording');
                const icon = document.getElementById('micIcon');
                const status = document.getElementById('recordingStatus');
                
                if (this.isRecording) {
                    button.className = 'mobile-button bg-red-500 text-white rounded-full p-4 md:p-6 text-xl md:text-2xl recording-pulse shadow-lg';
                    icon.className = 'fas fa-stop';
                    status.textContent = 'ğŸ¤ éŒ²éŸ³ä¸­... (ã‚¿ãƒƒãƒ—ã§åœæ­¢)';
                    status.className = 'mt-2 text-sm font-medium text-red-600';
                } else {
                    button.className = 'mobile-button bg-red-500 hover:bg-red-600 text-white rounded-full p-4 md:p-6 text-xl md:text-2xl transition-all duration-300 shadow-lg';
                    icon.className = 'fas fa-microphone';
                    status.textContent = 'ğŸ¤ éŸ³å£°èªè­˜åœæ­¢ä¸­ (ã‚¿ãƒƒãƒ—ã§é–‹å§‹)';
                    status.className = 'mt-2 text-sm font-medium text-gray-600';
                }
            }

            async translateText(text) {
                if (!text.trim()) return;
                
                try {
                    // è¨€èªæ¤œå‡º
                    const detectedLang = this.detectLanguage(text);
                    this.currentLanguage = detectedLang;
                    document.getElementById('currentLang').textContent = detectedLang === 'ja' ? 'æ—¥æœ¬èª' : 'è‹±èª';
                    
                    // ç¿»è¨³å®Ÿè¡Œ
                    const translatedText = await this.performTranslation(text, detectedLang);
                    
                    // çµæœè¡¨ç¤º
                    document.getElementById('currentTranslation').textContent = translatedText;
                    
                    // å±¥æ­´è¿½åŠ 
                    this.addToHistory(text, translatedText, detectedLang);
                    
                    // çµ±è¨ˆæ›´æ–°
                    this.translationCount++;
                    document.getElementById('translationCount').textContent = this.translationCount;
                    
                    // é–¢é€£æƒ…å ±ã®æ›´æ–°ã‚’ãƒˆãƒªã‚¬ãƒ¼
                    this.loadRelatedInfo(text);
                    
                } catch (error) {
                    console.error('ç¿»è¨³ã‚¨ãƒ©ãƒ¼:', error);
                    document.getElementById('currentTranslation').innerHTML = 
                        '<span style="color: #ef4444;">ç¿»è¨³ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚</span>';
                }
            }

            detectLanguage(text) {
                // ç°¡æ˜“è¨€èªæ¤œå‡ºï¼ˆæ—¥æœ¬èªæ–‡å­—ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯ï¼‰
                const japaneseRegex = /[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/;
                return japaneseRegex.test(text) ? 'ja' : 'en';
            }

            async performTranslation(text, sourceLang) {
                const targetLang = sourceLang === 'ja' ? 'en' : 'ja';
                
                // è¤‡æ•°ã®ç¿»è¨³æ–¹æ³•ã‚’è©¦è¡Œ
                const translationMethods = [
                    () => this.translateWithMyMemory(text, sourceLang, targetLang),
                    () => this.translateWithLibreTranslate(text, sourceLang, targetLang),
                    () => this.basicTranslate(text, sourceLang, targetLang)
                ];
                
                for (const method of translationMethods) {
                    try {
                        const result = await method();
                        if (result && result.trim()) {
                            return result;
                        }
                    } catch (error) {
                        console.warn('ç¿»è¨³æ–¹æ³•ã®ä¸€ã¤ãŒå¤±æ•—:', error);
                    }
                }
                
                return this.basicTranslate(text, sourceLang, targetLang);
            }

            async translateWithMyMemory(text, sourceLang, targetLang) {
                const langPair = `${sourceLang}|${targetLang}`;
                const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${langPair}`;
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.responseStatus === 200) {
                    return data.responseData.translatedText;
                }
                throw new Error('MyMemory translation failed');
            }

            async translateWithLibreTranslate(text, sourceLang, targetLang) {
                // LibreTranslateã®ç„¡æ–™APIã‚’ä½¿ç”¨ï¼ˆåˆ¶é™ã‚ã‚Šï¼‰
                const url = 'https://libretranslate.com/translate';
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        q: text,
                        source: sourceLang,
                        target: targetLang,
                        format: 'text'
                    })
                });
                
                const data = await response.json();
                if (data.translatedText) {
                    return data.translatedText;
                }
                throw new Error('LibreTranslate translation failed');
            }

            basicTranslate(text, sourceLang, targetLang) {
                // åŸºæœ¬çš„ãªè¾æ›¸ãƒ™ãƒ¼ã‚¹ç¿»è¨³ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
                const basicDict = {
                    'ja': {
                        'ã“ã‚“ã«ã¡ã¯': 'Hello',
                        'ãŠã¯ã‚ˆã†': 'Good morning',
                        'ã“ã‚“ã°ã‚“ã¯': 'Good evening',
                        'ã‚ã‚ŠãŒã¨ã†': 'Thank you',
                        'ã™ã¿ã¾ã›ã‚“': 'Excuse me',
                        'ã¯ã˜ã‚ã¾ã—ã¦': 'Nice to meet you',
                        'ä»Šæ—¥': 'today',
                        'å¤©æ°—': 'weather',
                        'ä»•äº‹': 'work',
                        'å‹‰å¼·': 'study'
                    },
                    'en': {
                        'hello': 'ã“ã‚“ã«ã¡ã¯',
                        'good morning': 'ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™',
                        'good evening': 'ã“ã‚“ã°ã‚“ã¯',
                        'thank you': 'ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™',
                        'excuse me': 'ã™ã¿ã¾ã›ã‚“',
                        'nice to meet you': 'ã¯ã˜ã‚ã¾ã—ã¦',
                        'today': 'ä»Šæ—¥',
                        'weather': 'å¤©æ°—',
                        'work': 'ä»•äº‹',
                        'study': 'å‹‰å¼·'
                    }
                };
                
                const dict = basicDict[sourceLang] || {};
                const lowerText = text.toLowerCase();
                
                for (const [key, value] of Object.entries(dict)) {
                    if (lowerText.includes(key.toLowerCase())) {
                        return value;
                    }
                }
                
                return `[ç¿»è¨³: ${text}]`;
            }

            addToHistory(original, translated, sourceLang) {
                const history = document.getElementById('translationHistory');
                const timestamp = new Date().toLocaleTimeString('ja-JP', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                const historyItem = document.createElement('div');
                historyItem.className = 'mb-2 p-2 bg-white rounded border-l-4 border-blue-400';
                historyItem.innerHTML = `
                    <div class="text-xs text-gray-500 mb-1">${timestamp} | ${sourceLang === 'ja' ? 'æ—¥â†’è‹±' : 'è‹±â†’æ—¥'}</div>
                    <div class="text-sm mb-1"><strong>åŸæ–‡:</strong> ${original}</div>
                    <div class="text-sm"><strong>ç¿»è¨³:</strong> ${translated}</div>
                `;
                
                if (history.children.length === 1 && history.children[0].textContent.includes('ç¿»è¨³å±¥æ­´ãŒã“ã“ã«')) {
                    history.innerHTML = '';
                }
                
                history.insertBefore(historyItem, history.firstChild);
                
                // å±¥æ­´ã‚’10ä»¶ã«åˆ¶é™
                while (history.children.length > 10) {
                    history.removeChild(history.lastChild);
                }
                
                this.translationHistory.push({
                    original,
                    translated,
                    sourceLang,
                    timestamp: new Date()
                });
            }

            clearTranslationHistory() {
                document.getElementById('translationHistory').innerHTML = 
                    '<p class="text-gray-500 text-sm text-center">ç¿»è¨³å±¥æ­´ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>';
                this.translationHistory = [];
            }

            async loadRelatedInfo(context = null) {
                const infoDiv = document.getElementById('relatedInfo');
                infoDiv.innerHTML = '<div class="text-center"><i class="fas fa-spinner fa-spin text-2xl mb-2"></i><p>æƒ…å ±ã‚’å–å¾—ä¸­...</p></div>';
                
                try {
                    let info;
                    if (context) {
                        info = await this.getContextRelatedInfo(context);
                    } else {
                        info = await this.getITTrendInfo();
                    }
                    
                    infoDiv.innerHTML = info;
                    this.infoCount++;
                    document.getElementById('infoCount').textContent = this.infoCount;
                    
                } catch (error) {
                    console.error('æƒ…å ±å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                    infoDiv.innerHTML = '<div class="text-center text-gray-500"><i class="fas fa-exclamation-triangle mb-2"></i><p>æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</p></div>';
                }
            }

            async getContextRelatedInfo(context) {
                // ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«åŸºã¥ãé–¢é€£æƒ…å ±ã®ç”Ÿæˆ
                const keywords = this.extractKeywords(context);
                
                if (keywords.length > 0) {
                    return this.generateRelatedInfo(keywords[0]);
                }
                
                return await this.getITTrendInfo();
            }

            extractKeywords(text) {
                const commonWords = ['ã§ã™', 'ã¾ã™', 'ã—ãŸ', 'ã™ã‚‹', 'ã‚ã‚‹', 'ã„ã‚‹', 'ã®', 'ã«', 'ã‚’', 'ã¯', 'ãŒ', 'ã§', 'ã¨', 'ã‹ã‚‰', 'ã¾ã§', 'a', 'an', 'the', 'is', 'are', 'was', 'were', 'in', 'on', 'at', 'to', 'for', 'of', 'with', 'by'];
                const words = text.toLowerCase().split(/\s+/).filter(word => 
                    word.length > 2 && !commonWords.includes(word)
                );
                return [...new Set(words)].slice(0, 3);
            }

            generateRelatedInfo(keyword) {
                const infoDatabase = {
                    'å¤©æ°—': {
                        title: 'å¤©æ°—ã«é–¢ã™ã‚‹é›‘å­¦',
                        content: 'é›²ã®ç¨®é¡ã¯åŸºæœ¬çš„ã«10ç¨®é¡ã«åˆ†é¡ã•ã‚Œã€ãã‚Œãã‚Œç•°ãªã‚‹é«˜åº¦ã«å½¢æˆã•ã‚Œã¾ã™ã€‚ç©é›²ã¯è‰¯ã„å¤©æ°—ã®è±¡å¾´ã§ã™ãŒã€ç©ä¹±é›²ã¯æ¿€ã—ã„é›·é›¨ã‚’ã‚‚ãŸã‚‰ã™ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚',
                        category: 'è‡ªç„¶ç§‘å­¦'
                    },
                    'ä»•äº‹': {
                        title: 'ãƒªãƒ¢ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚¯ã®ãƒˆãƒ¬ãƒ³ãƒ‰',
                        content: '2024å¹´ç¾åœ¨ã€ä¸–ç•Œã®ç´„35%ã®ä¼æ¥­ãŒãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ãƒ¯ãƒ¼ã‚¯ã‚’æ¡ç”¨ã€‚ç”Ÿç”£æ€§å‘ä¸Šã¨å¾“æ¥­å“¡æº€è¶³åº¦ã®ä¸¡é¢ã§ãƒ¡ãƒªãƒƒãƒˆãŒå ±å‘Šã•ã‚Œã¦ã„ã¾ã™ã€‚',
                        category: 'ãƒ“ã‚¸ãƒã‚¹'
                    },
                    'weather': {
                        title: 'Weather Facts',
                        content: 'Did you know that lightning strikes the Earth about 100 times per second? That\'s roughly 8.6 million times per day worldwide!',
                        category: 'Science'
                    },
                    'work': {
                        title: 'Future of Work',
                        content: 'AI and automation are expected to create 97 million new jobs by 2025, while transforming existing roles across industries.',
                        category: 'Technology'
                    }
                };
                
                const info = infoDatabase[keyword] || this.getRandomITInfo();
                
                return `
                    <div class="mb-3">
                        <span class="inline-block bg-purple-100 text-purple-800 px-2 py-1 rounded text-xs font-medium">
                            ${info.category}
                        </span>
                    </div>
                    <h4 class="font-semibold text-gray-800 mb-2">${info.title}</h4>
                    <p class="text-gray-600 leading-relaxed">${info.content}</p>
                `;
            }

            async getITTrendInfo() {
                const trends = [
                    {
                        title: 'AIé–‹ç™ºã®æœ€æ–°å‹•å‘',
                        content: 'ChatGPT-4ã€Claudeã€Geminiãªã©ã®å¤§è¦æ¨¡è¨€èªãƒ¢ãƒ‡ãƒ«ãŒæ€¥é€Ÿã«é€²åŒ–ã€‚2024å¹´ã¯ç‰¹ã«ãƒãƒ«ãƒãƒ¢ãƒ¼ãƒ€ãƒ«AIï¼ˆãƒ†ã‚­ã‚¹ãƒˆã€ç”»åƒã€éŸ³å£°ã‚’çµ±åˆå‡¦ç†ï¼‰ãŒæ³¨ç›®ã•ã‚Œã¦ã„ã¾ã™ã€‚',
                        category: 'AIæŠ€è¡“'
                    },
                    {
                        title: 'Web3ã¨ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³',
                        content: 'åˆ†æ•£å‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆDAppsï¼‰ã®å®Ÿç”¨åŒ–ãŒé€²ã‚€ä¸­ã€ã‚¤ãƒ¼ã‚µãƒªã‚¢ãƒ ã®ç’°å¢ƒè² è·è»½æ¸›ã‚„Layer2ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ™®åŠã€‚NFTã‹ã‚‰å®Ÿç”¨çš„ãªãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã¸ã‚·ãƒ•ãƒˆã€‚',
                        category: 'ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³'
                    },
                    {
                        title: 'ã‚¯ãƒ©ã‚¦ãƒ‰ãƒã‚¤ãƒ†ã‚£ãƒ–æŠ€è¡“',
                        content: 'Kubernetesã€Dockerã€ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãŒæ¨™æº–åŒ–ã€‚AWSã€Azureã€GCPãŒæä¾›ã™ã‚‹ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹æŠ€è¡“ã‚‚ä¼æ¥­å°å…¥ãŒåŠ é€Ÿã€‚',
                        category: 'ã‚¯ãƒ©ã‚¦ãƒ‰'
                    },
                    {
                        title: 'ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªãƒˆãƒ¬ãƒ³ãƒ‰',
                        content: 'Rustã€Goã€TypeScriptã®äººæ°—ãŒä¸Šæ˜‡ã€‚Pythonã¯ä¾ç„¶ã¨ã—ã¦AI/MLåˆ†é‡ã§åœ§å€’çš„ã‚·ã‚§ã‚¢ã€‚WebAssemblyï¼ˆWASMï¼‰ã«ã‚ˆã‚‹é«˜æ€§èƒ½Webé–‹ç™ºã‚‚æ³¨ç›®ã€‚',
                        category: 'é–‹ç™ºè¨€èª'
                    },
                    {
                        title: 'ã‚µã‚¤ãƒãƒ¼ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£',
                        content: 'ã‚¼ãƒ­ãƒˆãƒ©ã‚¹ãƒˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¢ãƒ‡ãƒ«ãŒä¸»æµã«ã€‚AIã‚’æ´»ç”¨ã—ãŸè„…å¨æ¤œå‡ºã‚·ã‚¹ãƒ†ãƒ ã¨ã€é‡å­ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿æ™‚ä»£ã«å‚™ãˆãŸæš—å·æŠ€è¡“ã®ç ”ç©¶ãŒé€²è¡Œä¸­ã€‚',
                        category: 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£'
                    },
                    {
                        title: 'EdTechï¼ˆæ•™è‚²æŠ€è¡“ï¼‰',
                        content: 'VR/ARæŠ€è¡“ã‚’æ´»ç”¨ã—ãŸæ²¡å…¥å‹å­¦ç¿’ä½“é¨“ã€AIãƒ‘ãƒ¼ã‚½ãƒŠãƒ«å®¶åº­æ•™å¸«ã€ãƒ–ãƒ­ãƒƒã‚¯ãƒã‚§ãƒ¼ãƒ³è¨¼æ˜æ›¸ã‚·ã‚¹ãƒ†ãƒ ãªã©ã€æ•™è‚²ã®ãƒ‡ã‚¸ã‚¿ãƒ«å¤‰é©ãŒåŠ é€Ÿã€‚',
                        category: 'æ•™è‚²æŠ€è¡“'
                    }
                ];
                
                const randomTrend = trends[Math.floor(Math.random() * trends.length)];
                
                return `
                    <div class="mb-3">
                        <span class="inline-block bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs font-medium">
                            ${randomTrend.category}
                        </span>
                    </div>
                    <h4 class="font-semibold text-gray-800 mb-2">${randomTrend.title}</h4>
                    <p class="text-gray-600 leading-relaxed">${randomTrend.content}</p>
                    <div class="mt-3 pt-3 border-t border-gray-200">
                        <p class="text-xs text-gray-500">
                            <i class="fas fa-clock mr-1"></i>
                            æœ€æ–°ã®ITæ¥­ç•Œãƒˆãƒ¬ãƒ³ãƒ‰æƒ…å ±
                        </p>
                    </div>
                `;
            }

            getRandomITInfo() {
                const infos = [
                    {
                        title: 'ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è±†çŸ¥è­˜',
                        content: 'ä¸–ç•Œåˆã®ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼ã¯ã‚¨ã‚¤ãƒ€ãƒ»ãƒ©ãƒ–ãƒ¬ãƒ¼ã‚¹ï¼ˆ1843å¹´ï¼‰ã¨ã•ã‚Œã€å½¼å¥³ã¯ãƒãƒ£ãƒ¼ãƒ«ã‚ºãƒ»ãƒãƒ™ãƒƒã‚¸ã®è§£æã‚¨ãƒ³ã‚¸ãƒ³ç”¨ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆã—ã¾ã—ãŸã€‚',
                        category: 'ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°å²'
                    },
                    {
                        title: 'ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã®æ­´å²',
                        content: 'æœ€åˆã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã¯1991å¹´ã«CERNã§å…¬é–‹ã•ã‚Œã€ä»Šã§ã‚‚http://info.cern.ch/hypertext/WWW/TheProject.htmlã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ã€‚',
                        category: 'Webæ­´å²'
                    },
                    {
                        title: 'é‡å­ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿',
                        content: 'é‡å­ãƒ“ãƒƒãƒˆï¼ˆqubitï¼‰ã¯0ã¨1ã®çŠ¶æ…‹ã‚’åŒæ™‚ã«æŒã¤ã“ã¨ãŒã§ãã€å¾“æ¥ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ã§ã¯æ•°ç™¾ä¸‡å¹´ã‹ã‹ã‚‹è¨ˆç®—ã‚’æ•°åˆ†ã§è§£ã‘ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚',
                        category: 'æ¬¡ä¸–ä»£æŠ€è¡“'
                    }
                ];
                
                return infos[Math.floor(Math.random() * infos.length)];
            }

            startInfoTimer() {
                this.infoTimerInterval = setInterval(() => {
                    this.infoTimer--;
                    document.getElementById('infoTimer').textContent = this.infoTimer;
                    
                    if (this.infoTimer <= 0) {
                        this.loadRelatedInfo();
                        this.infoTimer = 30;
                    }
                }, 1000);
            }

            updateSessionTime() {
                setInterval(() => {
                    const elapsed = Math.floor((Date.now() - this.sessionStartTime) / 1000);
                    const minutes = Math.floor(elapsed / 60);
                    const seconds = elapsed % 60;
                    document.getElementById('sessionTime').textContent = 
                        `${minutes}:${seconds.toString().padStart(2, '0')}`;
                }, 1000);
            }

            loadInitialInfo() {
                this.loadRelatedInfo();
            }
        }

        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
        document.addEventListener('DOMContentLoaded', () => {
            new MobileTranslationApp();
        });
    </script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDnExmXC%2BNqHNDgFhaAE43dibyCRTLwyvweq2spXfoPUHbWVMsxhcK3s8C%2B69AUjK5h2S1zJrFN%2BtHtIOP0kNdwUVyzyqhl2b6xwGqULrDXveoKtB6Yl1Z8ZnZsH%2BcGfJxB%2F8VtfqmYmWmnyQYSZ0e31nsssNI3vvfMSWTI3fZaAYEi%2B4bi3zmMYJSybZkePO1wjSc7z3rJqXzvfqUeJhT7q1DEZfD%2BgSsC3XVo%2BeW19yTGP0Nu8DdV2XwoKXzJl6SIpYU4ZFOVaJObF5OyK%2BxSf7lqu4uBBw1Iyh9Eq6ARXyv3c%2BZ3jMwYBUaZPRKGVY%2FSJ748C1D2mOfGpr1EjcOmxG9UWQaHcWqSaC8p6jJZXiB8iuNPzGMpr5cAUpUlCFIey6EyPO59xzAh1sQAQJoasSDU1TSNlwcDZ0UN999jk%2FebgsVlTGoovaCJvSb9y4%2B30UotrjUJgF%2BrEEzTcbCtAe38RZ4lrz%2BUyxEixdRs410%2ByeYrdMBC1o8JgZKjrESzEWs63u1aaQx0vB81t3B4g%3D";
        window.__genspark_locale = "ja-JP";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDnExmXC+NqHNDgFhaAE43dibyCRTLwyvweq2spXfoPUHbWVMsxhcK3s8C+69AUjK5h2S1zJrFN+tHtIOP0kNdwUVyzyqhl2b6xwGqULrDXveoKtB6Yl1Z8ZnZsH+cGfJxB/8VtfqmYmWmnyQYSZ0e31nsssNI3vvfMSWTI3fZaAYEi+4bi3zmMYJSybZkePO1wjSc7z3rJqXzvfqUeJhT7q1DEZfD+gSsC3XVo+eW19yTGP0Nu8DdV2XwoKXzJl6SIpYU4ZFOVaJObF5OyK+xSf7lqu4uBBw1Iyh9Eq6ARXyv3c+Z3jMwYBUaZPRKGVY/SJ748C1D2mOfGpr1EjcOmxG9UWQaHcWqSaC8p6jJZXiB8iuNPzGMpr5cAUpUlCFIey6EyPO59xzAh1sQAQJoasSDU1TSNlwcDZ0UN999jk/ebgsVlTGoovaCJvSb9y4+30UotrjUJgF+rEEzTcbCtAe38RZ4lrz+UyxEixdRs410+yeYrdMBC1o8JgZKjrESzEWs63u1aaQx0vB81t3B4g=";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    